<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Streams | nimona</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="a new internet stack, or something like it">
    <meta name="go-import" content="nimona.io git https://github.com/nimona/go-nimona">
    
    <link rel="preload" href="/assets/css/0.styles.e801921c.css" as="style"><link rel="preload" href="/assets/js/app.963ebbe6.js" as="script"><link rel="preload" href="/assets/js/2.60242c8e.js" as="script"><link rel="preload" href="/assets/js/8.8fd45811.js" as="script"><link rel="prefetch" href="/assets/js/10.451da88a.js"><link rel="prefetch" href="/assets/js/11.1a7a7dca.js"><link rel="prefetch" href="/assets/js/12.211662fe.js"><link rel="prefetch" href="/assets/js/13.414bcb91.js"><link rel="prefetch" href="/assets/js/14.bd2caf16.js"><link rel="prefetch" href="/assets/js/15.b305eedd.js"><link rel="prefetch" href="/assets/js/16.a7c4ee4d.js"><link rel="prefetch" href="/assets/js/17.f04778e6.js"><link rel="prefetch" href="/assets/js/18.dcf039ed.js"><link rel="prefetch" href="/assets/js/19.7cc9bdf3.js"><link rel="prefetch" href="/assets/js/20.37b96a4b.js"><link rel="prefetch" href="/assets/js/21.9b80db24.js"><link rel="prefetch" href="/assets/js/22.7da0cb57.js"><link rel="prefetch" href="/assets/js/23.3df6a3a4.js"><link rel="prefetch" href="/assets/js/24.c44adaab.js"><link rel="prefetch" href="/assets/js/25.66bc985c.js"><link rel="prefetch" href="/assets/js/26.f9b71747.js"><link rel="prefetch" href="/assets/js/27.762c50d5.js"><link rel="prefetch" href="/assets/js/28.0d8e717b.js"><link rel="prefetch" href="/assets/js/29.1c828a9d.js"><link rel="prefetch" href="/assets/js/3.5d9c893e.js"><link rel="prefetch" href="/assets/js/30.8e74faa5.js"><link rel="prefetch" href="/assets/js/31.49111c3f.js"><link rel="prefetch" href="/assets/js/32.6861ef4b.js"><link rel="prefetch" href="/assets/js/33.2397e1c0.js"><link rel="prefetch" href="/assets/js/34.ae09eef1.js"><link rel="prefetch" href="/assets/js/35.d2e5e55c.js"><link rel="prefetch" href="/assets/js/4.0c53339c.js"><link rel="prefetch" href="/assets/js/5.8e1d4924.js"><link rel="prefetch" href="/assets/js/6.37103aeb.js"><link rel="prefetch" href="/assets/js/7.b9d44b5c.js"><link rel="prefetch" href="/assets/js/9.134fda45.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e801921c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Home
</a></div><div class="nav-item"><a href="/docs/concepts/" class="nav-link">
  Concepts
</a></div><div class="nav-item"><a href="/docs/proposals/" class="nav-link router-link-active">
  Proposals
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Documentation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/docs/design-decisions/" class="sidebar-link">Design Decisions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Concepts</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/networking/" class="sidebar-link">Networking</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/networking/#establishing-connections" class="sidebar-link">Establishing connections</a></li></ul></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/docs/objects" class="sidebar-heading clickable"><span>Objects</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/proposals/np001-hinted-object-notation/" class="sidebar-link">Hinting &amp; Hashing [np001]</a></li><li><a href="/docs/proposals/np002-structured-objects/" class="sidebar-link">Structure [np002]</a></li></ul></section></li><li><a href="/docs/proposals/np003-streams/" aria-current="page" class="active sidebar-link">Streams [np003]</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#simple-summary" class="sidebar-link">Simple Summary</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#problem-statement" class="sidebar-link">Problem Statement</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#proposal" class="sidebar-link">Proposal</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#structure" class="sidebar-link">Structure</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#access-control" class="sidebar-link">Access control</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#hypothetical-roots" class="sidebar-link">Hypothetical roots</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#synchronization" class="sidebar-link">Synchronization</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#subscriptions" class="sidebar-link">Subscriptions</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np003-streams/#references" class="sidebar-link">References</a></li></ul></li><li><a href="/docs/proposals/np004-feeds/" class="sidebar-link">Feeds [np004]</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/proposals/np004-feeds/#simple-summary" class="sidebar-link">Simple Summary</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np004-feeds/#problem-statement" class="sidebar-link">Problem statement</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/np004-feeds/#proposal" class="sidebar-link">Proposal</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/proposals/" aria-current="page" class="sidebar-link">Nimona Proposals</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/proposals/#meta" class="sidebar-link">Meta</a></li><li class="sidebar-sub-header"><a href="/docs/proposals/#objects" class="sidebar-link">Objects</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="streams"><a href="#streams" class="header-anchor">#</a> Streams</h1> <h2 id="simple-summary"><a href="#simple-summary" class="header-anchor">#</a> Simple Summary</h2> <p>Streams provide a way of creating complex mutable data structures using
directed acyclic graphs made from objects.</p> <h2 id="problem-statement"><a href="#problem-statement" class="header-anchor">#</a> Problem Statement</h2> <p>While objects on their own are useful for creating permanent content-addressable
data structures, there are very few applications where data never get updated.
This is where streams come in, they allow developers to create complex
applications by applying event driven and event sourcing patterns using graphs
of individually immutable objects.</p> <h2 id="proposal"><a href="#proposal" class="header-anchor">#</a> Proposal</h2> <p>Objects in a stream form a directed acyclic graph (DAG) by allowing each of the
objects to reference others it depends on or knows of. This graph can then be
serialized into a linear series of objects that can be replayed consistently by
everyone that has the same representation of the graph.</p> <p>Streams are identified by the hash of their root object. This means that even
though each of their objects is content-addressable; the stream as a whole is
not, as its root hash (and thus identifier) does not change when more objects
are added to the graph.</p> <p>The benefit of this is that there is no need to find a way to reference the
stream as it changes. The downside is that you do not really know if you have
actually  received the whole stream and whether peers are not holding back on
you.</p> <p><img src="/assets/img/np003-streams.drawio.b6b06b4a.svg" alt="stream"></p> <h2 id="structure"><a href="#structure" class="header-anchor">#</a> Structure</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;type:s&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stream:nimona.io/kv&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data:m&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="access-control"><a href="#access-control" class="header-anchor">#</a> Access control</h2> <p><em>Note: Work in progress.</em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type:s&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nimona.io/profile.Created&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;owner:a&quot;</span><span class="token operator">:</span> <span class="token string">&quot;f00&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;policy:m&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;subjects:as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resources:as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;action:s&quot;</span><span class="token operator">:</span> <span class="token string">&quot;READ&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allow:b&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hypothetical-roots"><a href="#hypothetical-roots" class="header-anchor">#</a> Hypothetical roots</h2> <p>As mentioned before, streams are identified by the hash of their root object. In
order for a peer to find the providers of a stream and get its objects, it must
at the very least know its identifier. This is usually not an issue as most
times a peer will learn about the existence of a stream from somewhere before
deciding to request it. There are some cases though where that might not be the
case, especially when looking for something that might be considered relatively
&quot;well known&quot;.</p> <p>An example of this would be the profile stream of an identity. Let's say we are
looking at a blog post that a single author. Unless the blog post somehow
contains a link to the author's profile stream, there is no other way to easily
find the stream's identifier.</p> <p>This is where hypothetical roots come in.</p> <p>A hypothetical root is an object that identifies a stream and can be assumed
exists given the type of stream and the author that would have created it. This
allows peers to find streams unique to an identity without having to somehow
learn of their existence.</p> <p>Since the hypothetical root does not contain a policy, the stream starts off as
publicly accessible but writable only by the author. The author can subsequently
decide to restrict the rest of the stream by using a more strict policy.</p> <hr> <p>Let's go back to our original example of profile streams.</p> <p>Assuming that peer <code>a11</code> wants the profile stream for the identity <code>f00</code>, all it
has to do is construct the hypothetical root, calculate its hash, and find
providers for it on the network.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type:s&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nimona.io/profile.Created&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author:s&quot;</span><span class="token operator">:</span> <span class="token string">&quot;f00&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The hash of this object is <code>oh1.9KQhQ4UGaQPEyUDAAPDmVJCoHnGtJY7Aun4coFATXCYK</code>
and the peer can now lookup the providers for this object, and sync the
remaining stream.</p> <hr> <p>The NDL for defining hypothetical roots is as follows. Additional objects can be
defined in the stream as needed, but the hypothetical root object itself cannot
have additional properties.</p> <div class="language-ndl extra-class"><pre class="language-text"><code>stream nimona.io/profile {
    hypothetical root object Created { }
    signed object NameUpdated {
        nameFirst string
        nameLast string
        dependsOn repeated relationship
    }
}
</code></pre></div><h2 id="synchronization"><a href="#synchronization" class="header-anchor">#</a> Synchronization</h2> <p><em>Note: Work in progress.</em></p> <div class="language-ndl extra-class"><pre class="language-text"><code>    signed object nimona.io/stream.StreamRequest {
        nonce string
        leaves repeated nimona.io/object.Hash
    }
</code></pre></div><div class="language-ndl extra-class"><pre class="language-text"><code>    signed object nimona.io/stream.StreamResponse {
        nonce string
        children repeated nimona.io/object.Hash
    }
</code></pre></div><div class="language-ndl extra-class"><pre class="language-text"><code>    signed object nimona.io/stream.Announcement {
        nonce string
        leaves repeated nimona.io/object.Hash
    }
</code></pre></div><h2 id="subscriptions"><a href="#subscriptions" class="header-anchor">#</a> Subscriptions</h2> <p>Peers can &quot;subscribe&quot; to stream updates by creating and sending subscriptions to
other peers. A subscription can be used to subscribe on updates to one or more
streams using the streams' root hash and must also specify an expiration time
for the subscription.</p> <p>When a peer receives or creates an update for a stream, they will go through the
subscriptions they have received, and notify the relevant peers about the new
updates. If the subscriber does not have have access to the stream, no
notification will be sent.</p> <div class="language-ndl extra-class"><pre class="language-text"><code>signed object nimona.io/stream.Subscription {
    rootHashes nimona.io/object.Hash
    expiry nimona.io/object.DateTime
}
</code></pre></div><p>Subscriptions can also be added as stream events. This allows identities and
peers that have write access to a stream to denote their interest in receiving
updates about that stream. In this case <code>rootHashes</code> should be empty and the
expiry is optional.</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><a href="https://docs.textile.io/threads/#threads" target="_blank" rel="noopener noreferrer">https://docs.textile.io/threads/#threads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.streamr.com/docs/streams" target="_blank" rel="noopener noreferrer">https://www.streamr.com/docs/streams<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://holochain.org" target="_blank" rel="noopener noreferrer">https://holochain.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/textileio/go-textile/issues/694" target="_blank" rel="noopener noreferrer">https://github.com/textileio/go-textile/issues/694<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tuhrig.de/messages-vs-events-vs-commands" target="_blank" rel="noopener noreferrer">https://tuhrig.de/messages-vs-events-vs-commands<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.swirlds.com/downloads/SWIRLDS-TR-2016-01.pdf" target="_blank" rel="noopener noreferrer">https://www.swirlds.com/downloads/SWIRLDS-TR-2016-01.pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://arxiv.org/pdf/1710.04469.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/1710.04469.pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://archagon.net/blog/2018/03/24/data-laced-with-history" target="_blank" rel="noopener noreferrer">http://archagon.net/blog/2018/03/24/data-laced-with-history<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/proposals/np002-structured-objects/" class="prev">
        Structure [np002]
      </a></span> <span class="next"><a href="/docs/proposals/np004-feeds/">
        Feeds [np004]
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.963ebbe6.js" defer></script><script src="/assets/js/2.60242c8e.js" defer></script><script src="/assets/js/8.8fd45811.js" defer></script>
  </body>
</html>
