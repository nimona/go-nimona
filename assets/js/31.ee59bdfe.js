(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{403:function(e,t,a){"use strict";a.r(t);var n=a(48),r=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"hinted-object-notation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hinted-object-notation"}},[e._v("#")]),e._v(" Hinted Object Notation")]),e._v(" "),a("h2",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[e._v("#")]),e._v(" Simple Summary")]),e._v(" "),a("p",[e._v("A relatively strongly typed and self-describing data format that can be\ntransported through any means and encoding.")]),e._v(" "),a("h2",{attrs:{id:"problem-statement"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#problem-statement"}},[e._v("#")]),e._v(" Problem Statement")]),e._v(" "),a("p",[e._v("One of the core design decisions for nimona was to base the protocol around\nmessages/events whatever you wanna call them.")]),e._v(" "),a("p",[e._v("This means that all clients must be able to produce and consume structured data.\nMany of the existing data formats could be used but present some downsides for\nour use-cases.")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.json.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON"),a("OutboundLink")],1),e._v(", YAML, XML provide human friendly output which we feel is important\nbut do not have strong types and programming languages provide inconsistent\nresults.")]),e._v(" "),a("li",[a("a",{attrs:{href:"http://cbor.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("CBOR"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://msgpack.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("MsgPack"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://capnproto.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cap-n-proto"),a("OutboundLink")],1),e._v(" on the other side, provide binary\nserialization that is machine readable, but are strongly typed and will\nprovide consistent results in all languages.")]),e._v(" "),a("li",[e._v("Protobuf provides binary output and can even support self described data\nusing Any messages.")])]),e._v(" "),a("p",[e._v("Because of the nature of the protocol we're building the format of the data will\nbe something that will be hard to change in the future mostly due to the fact\nthat content hashes will depend on the serialized data and thus the format we\nchose.")]),e._v(" "),a("h2",{attrs:{id:"proposal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proposal"}},[e._v("#")]),e._v(" Proposal")]),e._v(" "),a("p",[e._v('In order to find a format that best suites our needs, we are proposing "Hinted\nObject Notation".')]),e._v(" "),a("p",[e._v("This work is based on the amazing work of a number of projects that have been\nadapted to work together and fit the requirements of nimona.\n"),a("a",{attrs:{href:"https://www.json.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://json-ld.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON-LD"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://json-schema.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON-Schema"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://tjson.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tagged JSON"),a("OutboundLink")],1),e._v(", and "),a("a",{attrs:{href:"https://github.com/benlaurie/objecthash",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object hash"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("It does not define how data should be encoded or decoded when being transported.\nWe can use any data format such as "),a("a",{attrs:{href:"https://www.json.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"http://cbor.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("CBOR"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://msgpack.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("MsgPack"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://capnproto.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cap-n-proto"),a("OutboundLink")],1),e._v(",\nand others.")]),e._v(" "),a("p",[e._v("Instead its purpose is to be able to define structured, (relatively) strongly-\ntyped and self-describing data that can be transported through any means and\nencodings while still being able to consistently produce the same cryptographic\nhash.")]),e._v(" "),a("p",[e._v("It has its own list of basic types and structures, more closely resembling\nthe ones of "),a("a",{attrs:{href:"https://www.json.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON"),a("OutboundLink")],1),e._v(", other than the separation of number to int/uint/float, and\nthe ability to add more types as we move forward.")]),e._v(" "),a("ul",[a("li",[e._v("Map - A collection of alphabetically sorted key/value pairs")]),e._v(" "),a("li",[e._v("Array - An ordered list of values")]),e._v(" "),a("li",[e._v("String")]),e._v(" "),a("li",[e._v("Integer")]),e._v(" "),a("li",[e._v("Unsigned Integer")]),e._v(" "),a("li",[e._v("Float")]),e._v(" "),a("li",[e._v("Data (binary data)")]),e._v(" "),a("li",[e._v("Boolean")])]),e._v(" "),a("p",[e._v("Continuing its comparison with "),a("a",{attrs:{href:"https://www.json.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON"),a("OutboundLink")],1),e._v(", there are some restrictions that are not\npresent in the JSON format.")]),e._v(" "),a("ul",[a("li",[e._v("The top-level Object must always be a map.")]),e._v(" "),a("li",[e._v("All values of an array must be of the same type.")]),e._v(" "),a("li",[e._v("A number of key names are reserved.")]),e._v(" "),a("li",[e._v("All keys must end with the type hint of their value.")])]),e._v(" "),a("h3",{attrs:{id:"features"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#features"}},[e._v("#")]),e._v(" Features")]),e._v(" "),a("p",[e._v("Objects provide a number of interesting features:")]),e._v(" "),a("h4",{attrs:{id:"type-hinting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#type-hinting"}},[e._v("#")]),e._v(" Type hinting")]),e._v(" "),a("p",[e._v("In order to allow Objects to be encoding and language agnostic, the types of\nall values have to be able to survive multiple re-encodings between incompatible\nformats, languages, and libraries.")]),e._v(" "),a("p",[e._v("Since we can’t depend on each encoding format to keep the correct type, we\nprovide a hint for the value’s type as part of the key.")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"some-string:s"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"nested-object:m"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"unsigned-number-one:u"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"array-of-ints:ai"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("-1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Hints for all of the supported types and structures:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("m")]),e._v(" map")]),e._v(" "),a("li",[a("code",[e._v("s")]),e._v(" string")]),e._v(" "),a("li",[a("code",[e._v("i")]),e._v(" int")]),e._v(" "),a("li",[a("code",[e._v("u")]),e._v(" uint")]),e._v(" "),a("li",[a("code",[e._v("f")]),e._v(" float")]),e._v(" "),a("li",[a("code",[e._v("d")]),e._v(" data (binary)")]),e._v(" "),a("li",[a("code",[e._v("b")]),e._v(" bool")]),e._v(" "),a("li",[a("code",[e._v("a")]),e._v(" array\n"),a("ul",[a("li",[a("code",[e._v("ax")]),e._v(" array of type "),a("code",[e._v("x")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("aax")]),e._v(" nested array of type "),a("code",[e._v("x")])])])])])]),e._v(" "),a("li",[a("code",[e._v("r")]),e._v(" reference "),a("em",[e._v("We’ll come back to this one later")])])]),e._v(" "),a("p",[a("em",[e._v("Note: Type hinting is based on the "),a("a",{attrs:{href:"https://tjson.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tagged JSON"),a("OutboundLink")],1),e._v(" micro-format with a couple\nof minor changes; mainly terminology, the hints/tags used, the removal of sets\nand binary data formats, and the addition of the object reference type.")])]),e._v(" "),a("h4",{attrs:{id:"consistent-hashing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consistent-hashing"}},[e._v("#")]),e._v(" Consistent hashing")]),e._v(" "),a("p",[e._v("Instead of defining a consistent way of serializing a map into bytes and\nhashing the result, we are instead hashing each attribute of the map\nindependently, collect their hashes and hash them again.")]),e._v(" "),a("p",[e._v("This allows decoupling the transport encoding of a map from its hash.")]),e._v(" "),a("p",[e._v("In addition it allows for providing additional attributes in the object that\ndo not have to be included in the hash, such attributes are prefixed with an\nunderscore.")]),e._v(" "),a("p",[e._v("Finally it allows for the redaction of attribute values from the object without\nchanging the hash of the complete object.\nSince each value is hashed individually, the sender of an object can instead\nof sending the value of an attribute send its hash.\nThe recipient will still be able to generate the hash for the object even\nwithout having access to the underlying value.")]),e._v(" "),a("p",[e._v("Object-Hashing is based off the JSON version of "),a("a",{attrs:{href:"https://github.com/benlaurie",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ben Laurie"),a("OutboundLink")],1),e._v("’s "),a("a",{attrs:{href:"https://github.com/benlaurie/objecthash",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object hash"),a("OutboundLink")],1),e._v("\nand provides a way to consistently hash objects that works across languages\nand encodings.")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("s")]),e._v(" strings get converted into their UTF8 byte equivalent and hashed.")]),e._v(" "),a("li",[a("code",[e._v("i")]),e._v(" and "),a("code",[e._v("u")]),e._v(" integers get converted into strings and then hashed as strings.")]),e._v(" "),a("li",[a("code",[e._v("f")]),e._v(" floats get converted into their IEEE 754 representation and hashed.")]),e._v(" "),a("li",[a("code",[e._v("b")]),e._v(" bools get converted to single bytes 0/1 and hashed.")]),e._v(" "),a("li",[a("code",[e._v("d")]),e._v(" data are simply hashed as they are.")]),e._v(" "),a("li",[a("code",[e._v("r")]),e._v(" references do not get hashed again, they are returned untouched.")]),e._v(" "),a("li",[a("code",[e._v("a")]),e._v(" for arrays, we go through all their values, hash them according to their\nhint, concat all the hashes, and hash the result.\n"),a("code",[e._v("h( h(v0) + h(v1) + ...)")])]),e._v(" "),a("li",[a("code",[e._v("m")]),e._v(" for maps, we loop through the sorted key/value pairs, hash each key and\nvalue, and append them to the previous pair. Finally hash the result.\n"),a("code",[e._v("h( h(k0) + h(v0) + h(k1) + h(v1) + ...)")])])]),e._v(" "),a("p",[a("em",[e._v("Note: keys starting with an underscore ("),a("code",[e._v("_")]),e._v(") should be ignored and not be part\nof the hash.")])]),e._v(" "),a("p",[a("em",[e._v("Note: at this moment only maps can be redacted.")])]),e._v(" "),a("p",[a("em",[e._v("Note: when hashing maps, their type should be always changed to "),a("code",[e._v("r")]),e._v(".\nSo that "),a("code",[e._v("foo:m")]),e._v(" would become "),a("code",[e._v("foo:r")]),e._v(" before hashing.`")])]),e._v(" "),a("h3",{attrs:{id:"referencing-and-redaction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#referencing-and-redaction"}},[e._v("#")]),e._v(" Referencing and Redaction")]),e._v(" "),a("p",[e._v("References enable redacting values of an object without affecting its hash.")]),e._v(" "),a("p",[e._v("Let’s say that the following object results in a hash of "),a("code",[e._v("454fc56c03071d9")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"some-string:s"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"nested-object:m"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"unsigned-number-one:u"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"array-of-ints:ai"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("-1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("While the hash of its nested object is "),a("code",[e._v("3b4ba8e4fd82231")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"unsigned-number-one:u"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"array-of-ints:ai"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("-1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("We can replace the nested object with its hash, and still get the same hash\nas when we had the full object in its place; "),a("code",[e._v("454fc56c03071d9")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"some-string:s"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"nested-object:r"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"3b4ba8e4fd82231"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Notice that now the type hint has been changed from "),a("code",[e._v("m")]),e._v(" (object) to "),a("code",[e._v("r")]),e._v(".\nWhile we are normally hashing the map, we are also changing the hint to "),a("code",[e._v("r")]),e._v(".")]),e._v(" "),a("p",[a("em",[e._v("Note: As we start using Objects to create more complex data structures and\ngraphs, object references will be used to reduce the size of repeated\ninformation between different objects.")])]),e._v(" "),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.json.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"http://cbor.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("CBOR"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://msgpack.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("MsgPack"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://capnproto.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cap-n-proto"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://json-ld.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON-LD"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://json-schema.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON-Schema"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://tjson.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tagged JSON"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/benlaurie",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ben Laurie"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/benlaurie/objecthash",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object hash"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);